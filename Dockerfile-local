# Use the same base as your dev/prod Dockerfile
FROM rust:1.88-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    pkg-config \
    libssl-dev \
    postgresql-client \
    curl \
    ca-certificates \
    git \
    openssh-client \
    && rm -rf /var/lib/apt/lists/*

# Install cargo tools (dev only)
RUN cargo install cargo-watch
RUN cargo install sqlx-cli --no-default-features --features postgres

# Set working directory
WORKDIR /workspace

# Optional: Pre-cache dependencies (improves first build)
COPY Cargo.toml Cargo.lock ./
RUN mkdir -p src && echo "fn main() {}" > src/main.rs
RUN cargo build --release || true
RUN rm -rf src

# Copy full project (Dev Container will mount host volume anyway, but this helps with intellisense immediately)
COPY . .

# Expose port for Axum
EXPOSE 3000

# Default shell (we won't auto-run the app here â€” cargo is run manually or via tasks.json)
CMD [ "bash" ]
